<div id="page" class="maincontent">

    <h1>Terrariums<span ng-if="showSpinner"><i class="fa fa-spinner fa-spin"></i></span></h1>
    <br/>

    <div>
        <div ng-if="!terDetails && !thingyDetails">
            <button class="btn btn-primary" ng-click="loadData()"><i class="fa fa-fw fa-refresh"></i>Reload data</button>
            <button class="btn btn-success pull-right" ng-click="showCreateTerrarium()"><i class="fa fa-fw fa-asterisk"></i>Create new terrarium</button>
        </div>
        <div ng-if="terDetails || thingyDetails">
            <button class="btn btn-primary" ng-click="loadData()"><i class="fa fa-fw fa-backward"></i>Terrarium list</button>
            <button ng-if="thingyDetails" class="btn btn-primary" ng-click="showTerDetails(thingyDetails.ter)"><i class="fa fa-fw fa-info"></i>terrarium details</button>
        </div>
    </div>
    <br/>

    <div ng-if="!showSpinner">
        <div ng-if="!terDetails && !thingyDetails" class="row">
            <div ng-repeat="terrarium in terrariums | orderBy:['-isDefault','name']" class="col-lg-6">
                <div class="panel" ng-class="{'panel-info':!terrarium.isDefault, 'panel-success':terrarium.isDefault}">
                    <div ng-click="showTerDetails(terrarium)" class="panel-heading">
                        <h3 class="panel-title">{{terrarium.name}}</h3>
                    </div>
                    <div class="panel-body">
                        <p>{{terrarium.description}}</p>
                        <h3>Thingies</h3>
                        <ul>
                            <li ng-repeat="thingy in terrarium.thingies | orderBy:'description'">
                                <a ng-click="showThingyDetails(terrarium, thingy)" class="fakelink">{{thingy.description}} ({{thingy.macAddress}})</a>
                            </li>
                            <li ng-if="!terrarium.thingies || terrarium.thingies.length === 0">Terrarium has no Thingies</li>
                        </ul>
                        <button class="btn btn-primary pull-right" ng-click="showTerDetails(terrarium)"><i class="fa fa-fw fa-info"></i>Show details</button>
                        <button ng-if="!terrarium.isDefault" class="btn btn-danger pull-right" ng-click="showDeleteTerrarium(terrarium)"><i class="fa fa-fw fa-trash"></i>Delete terrarium</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div ng-if="terDetails" class="row">
        <div ng-if="!showSpinner && terDetails.thingies.length === 0" class="col-lg-12">
            <div class="alert alert-warning">
                <p>Terrarium has no Thingies.</p>
            </div>
        </div>
        <div ng-repeat="thingy in terDetails.thingies | orderBy:'description'" class="col-lg-6">
            <div class="panel panel-info">
                <div ng-click="showThingyDetails(terDetails, thingy)" class="panel-heading">
                    <h3 class="panel-title">{{thingy.description}} ({{terDetails.name}})<span class="pull-right">{{thingy.macAddress}}</span></h3>
                </div>
                <div class="panel-body">
                    <button class="btn btn-primary btn-corner" ng-click="showHistory(terDetails, thingy)"><i class="fa fa-fw fa-history"></i>history</button>
                    <h3>Sensor data</h3>
                    <ul>
                        <li>Humidity:</li>
                        <ul class="nobullets">
                            <li>{{thingy.humidities[0].value}} {{thingy.humidities[0].unit.short}}</li>
                            <li>Date: {{thingy.humidities[0].timestamp | date : 'dd.MM.yyyy - HH:mm'}}</li>
                        </ul>

                        <li>Air quality:</li>
                        <ul class="nobullets">
                            <li>TVOC: {{thingy.airQualities[0].tvoc.value}} {{thingy.airQualities[0].tvoc.unit.short}}</li>
                            <li>CO2: {{thingy.airQualities[0].co2.value}} {{thingy.airQualities[0].co2.unit.short}}</li>
                            <li>Date: {{thingy.airQualities[0].timestamp | date : 'dd.MM.yyyy - HH:mm'}}</li>
                        </ul>

                        <li>Temperature:</li>
                        <ul class="nobullets">
                            <li>{{thingy.temperatures[0].value}} {{thingy.temperatures[0].unit.short}}</li>
                            <li>Date: {{thingy.temperatures[0].timestamp | date : 'dd.MM.yyyy - HH:mm'}}</li>
                        </ul>
                    </ul>
                    <button class="btn btn-primary pull-right" ng-click="showThingyDetails(terDetails, thingy)"><i class="fa fa-fw fa-info"></i>Show details</button>
                </div>
            </div>
        </div>
    </div>

    <div ng-if="thingyDetails" class="row">
        <div class="col-lg-12">
            <div class="panel panel-info">
                <div class="panel-heading">
                    <h3 class="panel-title">{{thingyDetails.description}} - State<span class="pull-right">{{thingyDetails.macAddress}}</span></h3>
                </div>
                <div class="panel-body">
                    <button class="btn btn-primary btn-corner" ng-click="showHistory(thingyDetails.ter, thingyDetails)"><i class="fa fa-fw fa-history"></i>history</button>
                    <div class="row">
                        <div class="col-lg-6">
                            <h3>Sensor data</h3>
                            <ul>
                                <li>Humidity:</li>
                                <ul class="nobullets">
                                    <li>{{thingyDetails.humidities[0].value}} {{thingyDetails.humidities[0].unit.short}}</li>
                                    <li>Date: {{thingyDetails.humidities[0].timestamp | date : 'dd.MM.yyyy - HH:mm'}}</li>
                                </ul>

                                <li>Air quality:</li>
                                <ul class="nobullets">
                                    <li>TVOC: {{thingyDetails.airQualities[0].tvoc.value}} {{thingyDetails.airQualities[0].tvoc.unit.short}}</li>
                                    <li>CO2: {{thingyDetails.airQualities[0].co2.value}} {{thingyDetails.airQualities[0].co2.unit.short}}</li>
                                    <li>Date: {{thingyDetails.airQualities[0].timestamp | date : 'dd.MM.yyyy - HH:mm'}}</li>
                                </ul>

                                <li>Temperature:</li>
                                <ul class="nobullets">
                                    <li>{{thingyDetails.temperatures[0].value}} {{thingyDetails.temperatures[0].unit.short}}</li>
                                    <li>Date: {{thingyDetails.temperatures[0].timestamp | date : 'dd.MM.yyyy - HH:mm'}}</li>
                                </ul>
                            </ul>
                        </div>

                        <div class="col-lg-6">
                            <h3>Sensor State</h3>
                            <ul>
                                <li>Humidity:</li>
                                <ul class="nobullets">
                                    <li><span ng-class="thingyDetails.violation.humidity.clazz">{{thingyDetails.violation.humidity.text}}</span></li>
                                </ul>

                                <li>Air Quality:</li>
                                <ul class="nobullets">
                                    <li><span ng-class="thingyDetails.violation.tvoc.clazz">TVOC: {{thingyDetails.violation.tvoc.text}}</span></li>
                                    <li><span ng-class="thingyDetails.violation.co2.clazz">CO2: {{thingyDetails.violation.co2.text}}</span></li>
                                </ul>

                                <li>Temperature:</li>
                                <ul class="nobullets">
                                    <li><span ng-class="thingyDetails.violation.temp.clazz">{{thingyDetails.violation.temp.text}}</span></li>
                                </ul>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-12">
            <div class="panel panel-info">
                <div class="panel-heading">
                    <h3 class="panel-title">{{thingyDetails.description}} - Settings</h3>
                </div>
                <div class="panel-body">
                    <h3>Sensor configuration</h3>
                </div>
            </div>
        </div>
    </div>

    <div ng-include="'static/templates/modals/createTerrariumModal.html'"></div>
    <div ng-include="'static/templates/modals/deleteTerrariumModal.html'"></div>

</div>
